<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Usuarios Sencilla</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 2em auto; line-height: 1.6; }
        ul { list-style: none; padding: 0; }
        li { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding: 0.5em 0; }
        button.delete-btn { background-color: red; color: white; border: none; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Gestión de Usuarios</h1>
    
    <form id="userForm">
        <label for="userName">Nombre del nuevo usuario:</label>
        <input type="text" id="userName" name="userName" required>
        <button type="submit">Añadir Usuario</button>
    </form>
    
    <hr>

    <h2>Usuarios actuales</h2>
    <ul id="userList">
        </ul>

    <script>
/*
 * Este script de JavaScript se encarga de toda la lógica dinámica del frontend.
 * Su propósito es interactuar con una API RESTful para gestionar usuarios.
 * * Funciones Principales:
 * - fetchUsers(): Realiza una petición GET al backend para obtener la lista
 * actual de usuarios y la renderiza en la página.
 * - El evento 'submit' en el formulario: Captura los datos del formulario y
 * envía una petición POST al backend para crear un nuevo usuario.
 * - El evento 'click' en la lista de usuarios: Detecta clics en los botones de
 * 'Borrar' y envía una petición DELETE al backend para eliminar un usuario por su ID.
 * * El flujo de trabajo es asíncrono y se basa en promesas ('async/await')
 * para manejar las respuestas de la API de forma eficiente.
 */

        const userList = document.getElementById('userList');
        const userForm = document.getElementById('userForm');
        const apiUrl = 'http://192.168.56.112:5000/users';

        async function fetchUsers() {
            try {
                const response = await fetch(apiUrl);
                const users = await response.json();
                
                userList.innerHTML = '';
                users.forEach(user => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>ID: ${user.id} - Nombre: ${user.name}</span>
                        <button class="delete-btn" data-id="${user.id}">Borrar</button>
                    `;
                    userList.appendChild(li);
                });
            } catch (error) {
                console.error('Error al obtener los usuarios:', error);
            }
        }

        userForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userNameInput = document.getElementById('userName');
            const newUserName = userNameInput.value;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: newUserName })
                });
                
                if (response.ok) {
                    userNameInput.value = '';
                    fetchUsers();
                } else {
                    console.error('Error al crear el usuario:', await response.json());
                }
            } catch (error) {
                console.error('Error de conexión:', error);
            }
        });

        userList.addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const userId = e.target.getAttribute('data-id');
                try {
                    const response = await fetch(`${apiUrl}/${userId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        fetchUsers();
                    } else {
                        console.error('Error al borrar el usuario:', await response.json());
                    }
                } catch (error) {
                    console.error('Error de conexión:', error);
                }
            }
        });

        fetchUsers();
    </script>
</body>
</html>
